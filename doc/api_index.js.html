<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: api/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: api/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

/**
 * @alias module:booljs
 * @description Gets a bootstraper instance of a bool.js application
 * @param  {String} namespace   The namespace for the application
 * @return {Object}             The instance of a bool.js loaded application
 */
module.exports = function(namespace){

    var API         = require('booljs-api')
    ,   Folder      = require('./folder')
    ,   Config      = require('./configurations')
    ,   Loaders     = require('./loaders');

    var _instance   = API.App.getInstance(namespace)
    ,   _folders    = new Folder.List()
    ,   _dbloader   = 'booljs-nomodel'
    ,   _srvloader  = 'booljs-express'
    ,   _booted     = false
    ,   _server     = null;

    return {
        /**
         * @function
         * Sets a base folder for project, can be absolute or relative
         * @param {String} folder - the project's location.
         * @return {Object} The loaded application instance
         */
        setBase: function(folder){
            _folders.base = folder;
            return this;
        },
        /**
         * @function
         * Modifies standard folder names for components or even add new ones
         * to the projects structure
         * @param {String} key - The identifier of the resource or resources
         * group to be relocated
         * @param {String} folder - An absolute or relative location to point
         * the resource
         * @return {Object} The loaded application instance
         */
        setFolder: function(key, folder){
            _folders[key] = folder;
            return this;
        },
        /**
         * @function
         * Sets the name of a database loader for the project. Default loader
         * is mongoose driver for bool.js
         * @param {String} databaseLoader - The name of the module or route
         * where the loader is being required from node.js
         * @return {Object} The loaded application instance
         */
        setDatabaseLoader: function (databaseLoader) {
            _dbloader = databaseLoader;
            return this;
        },
        /**
         * @function
         * Sets the name of a server loader for the project. Default loader
         * is express driver for bool.js
         * @param {String} serverLoader - The name of the module or route
         * where the loader is being required from node.js
         * @return {Object} The loaded application instance
         */
        setServerLoader: function (serverLoader) {
            _srvloader = serverLoader;
            return this;
        },
        /**
         * @function
         * Adds BoolError to app components, so it can be used in application,
         * @param {Callback} done - Executes once process is complete.
         * @return {Object} The loaded application instance
         */
        insertBoolError: function (done) {
            done = done || function() {};

            try {
                _instance.insertComponent('Error', API.Error);
                done();
                return this;
            } catch(err){
                done(err);
                return this;
            }
        },
        /**
         * @function
         * Reads configurations. Gives hints about progress to notify user
         * what is happening.
         * @param {Callback} done - Executes when reading process is complete.
         * @param {Callback} progress - Executes once a single configuration
         * file has been read.
         * @return {Promise}
         */
        readConfigurations: function(done, progress){
            return new Config(
                _instance, _folders.configuration, done, progress
            );
        },
        /**
         * @function
         * Returns a list of the components' code files, so it's possible to
         * use them later to load code components
         * @param {Callback} done - Executes when reading process is complete.
         * @param {Callback} progress - Executes once a single configuration
         * file has been read.
         * @return {Promise}
         */
        readFiles: function(done, progress){
            var componentReaders = [];
            done = done || function () {};

            for(var route in _.omit(_folders.paths, 'configuration')){
                _instance.insertComponent(route, {});
                componentReaders.push(Folder.read(
                    _instance, _instance.getComponents()[route],
                    _folders[route], route,
                    null,
                    progress
                ));
            }

            // Reading components
            return q.all(componentReaders).then(function () {
                done();
            }).catch(done);
        },
        /**
         * @function
         * Opens a Database connection and fetches models using a database
         * loader.
         * @param {Callback} done - Executes when reading process is complete.
         * @param {Callback} progress - Executes once a single configuration
         * file has been read.
         * @return {Promise}
         */
        loadDatabase: function (done, progress) {
            done = done || function () {};
            return Loaders.database(_instance, _dbloader, done, progress);
        },
        /**
         * @function
         * Loads up components' code, wrapping them into objects
         * @param {Callback} done - Executes when reading process is complete.
         * @param {Callback} progress - Executes once a single configuration
         * file has been read.
         * @return {Promise}
         */
        loadComponents: function (done, progress) {
            done = done || function () {};

            return Loaders.components(_folders, _instance, done, progress);
        },
        /**
         * @function
         * Configures and boots up server
         * @param {Callback} done - Executes when reading process is complete.
         * @param {Callback} progress - Executes once a single configuration
         * file has been read.
         * @return {Promise}
         */
        bootServer: function (done, progress) {
            done = done || function () {};
            return Loaders.server(_instance, _srvloader, done, progress);
        },
        /**
         * Boots up bool.js
         * @param {Callback} done - Executes when reading process is complete.
         * @param {Callback} progress - Executes once a single configuration
         * file has been read.
         * @return {Promise}
         */
        run: function (done, progress) {
            var context = this;
            done = done || function () {};

            if(_booted){
                return q.resolve({
                    app: _instance.getComponents(),
                    server: _server
                });
            }

            return context.
                insertBoolError().
            readConfigurations().then(function () {
                return context.readFiles();
            }).then(function () {
                return context.loadDatabase();
            }).then(function () {
                return context.loadComponents();
            }).then(function () {
                return context.bootServer(done, progress);
            }).then(function (server) {
                _server = server;
                _booted = true;

                return q.resolve({
                    app: _instance.getComponents(),
                    server: _server
                });
            });
        }
    };

};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-booljs.html">booljs</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Configuresandbootsupserver">Configures and boots up server</a></li><li><a href="global.html#Modifiesstandardfoldernamesforcomponentsorevenaddnewonestotheprojectsstructure">Modifies standard folder names for components or even add new ones
to the projects structure</a></li><li><a href="global.html#OpensaDatabaseconnectionandfetchesmodelsusingadatabaseloader.">Opens a Database connection and fetches models using a database
loader.</a></li><li><a href="global.html#Readsconfigurations.Giveshintsaboutprogresstonotifyuserwhatishappening.">Reads configurations. Gives hints about progress to notify user
what is happening.</a></li><li><a href="global.html#Returnsalistofthecomponents'codefiles,soit'spossibletousethemlatertoloadcodecomponents">Returns a list of the components' code files, so it's possible to
use them later to load code components</a></li><li><a href="global.html#run">run</a></li><li><a href="global.html#Setsthenameofadatabaseloaderfortheproject.Defaultloaderismongoosedriverforbool.js">Sets the name of a database loader for the project. Default loader
is mongoose driver for bool.js</a></li><li><a href="global.html#Setsthenameofaserverloaderfortheproject.Defaultloaderisexpressdriverforbool.js">Sets the name of a server loader for the project. Default loader
is express driver for bool.js</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Sat Sep 12 2015 19:23:06 GMT-0500 (COT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
